<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ITパスポート：稼働率（直列・並列）アニメ＋段階説明</title>

<style>
  :root{
    --accent:#ff6f6f;
    --bg:#f6f7fb;
    --card:#ffffff;
    --ink:#1f2328;
    --muted:#495057;
    --good:#2e7d32;
    --bad:#d32f2f;
    --line:#dfe3ea;
    --shadow: 0 10px 28px rgba(0,0,0,.06);
  }

  *{ box-sizing:border-box; }
  body{
    margin:0;
    font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
    background:var(--bg);
    color:var(--ink);

    /* 大きい文字（講義向け） */
    font-size:21px;
    line-height:1.5;
  }

  header{
    background:var(--accent);
    color:#fff;
    padding:14px 16px;
    text-align:center;
    font-weight:1000;
    letter-spacing:.02em;
    font-size:24px;
  }

  /* 画面に追従して横幅可変 + 上限は広め */
  .wrap{
    width: min(96vw, 1500px);
    margin: 0 auto;
    padding: 12px;
  }

  /* タブ */
  .tabs{
    display:flex;
    gap:0;
    position:sticky;
    top:0;
    z-index:10;
    background:#eee;
    border-bottom:1px solid #ddd;
  }
  .tab{
    flex:1;
    padding:14px 10px;
    cursor:pointer;
    text-align:center;
    font-weight:1000;
    border-bottom:5px solid transparent;
    user-select:none;
    font-size:20px;
    background:#eee;
  }
  .tab.active{
    background:var(--card);
    border-bottom-color:var(--accent);
  }

  /* カード・レイアウト */
  .card{
    background:var(--card);
    border:1px solid #e8e9ee;
    border-radius:14px;
    padding:14px;
    box-shadow: var(--shadow);
    margin: 10px 0;
  }

  h2{
    margin:0 0 8px 0;
    font-size:26px;
    line-height:1.25;
  }

  .lead{
    margin:6px 0 0 0;
    color:var(--muted);
    font-weight:650;
  }

  .grid{
    display:grid;
    grid-template-columns: 1.4fr 1fr; /* 横長で見やすい */
    gap:12px;
  }
  @media (max-width: 1100px){
    .grid{ grid-template-columns: 1fr; }
  }

  /* 左：アニメステージ */
  .stage{
    border:1px solid #e6e6e6;
    border-radius:16px;
    padding:12px;
    background:linear-gradient(#fff, #fafafa);
    overflow:hidden;
  }

  .legend{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    margin:6px 0 10px;
    color:var(--muted);
    font-weight:900;
    font-size:18px;
  }
  .pill{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:8px 12px;
    border-radius:999px;
    background:#f2f2f2;
    border:1px solid #e3e3e3;
    font-weight:1000;
    color:#333;
    font-size:18px;
    white-space:nowrap;
  }
  .dot{
    width:12px;height:12px;border-radius:50%;
    display:inline-block;
  }
  .dot.good{background:var(--good)}
  .dot.bad{background:var(--bad)}
  .dot.neu{background:#777}

  .svgBox{
    width:100%;
    height:280px;
    display:block;
  }

  /* 操作エリア：原則1行、狭い時だけ折り返し */
  .controls{
    display:flex;
    gap:10px;
    align-items:center;
    flex-wrap:nowrap;
    margin-top:10px;
  }
  @media (max-width: 950px){
    .controls{ flex-wrap:wrap; }
  }

  button{
    border:none;
    background:var(--accent);
    color:#fff;
    padding:10px 12px;
    border-radius:12px;
    font-weight:1000;
    cursor:pointer;
    font-size:19px;
    white-space:nowrap;
  }
  button.secondary{ background:#444; }
  button:active{ transform: translateY(1px); }

  label{
    font-weight:1000;
    white-space:nowrap;
  }
  input[type="number"]{
    width:110px;
    padding:10px 12px;
    border:1px solid #ddd;
    border-radius:12px;
    font-size:20px;
  }

  .hint{
    margin-top:10px;
    padding:12px;
    border-left:5px solid var(--accent);
    background:#fff4f4;
    border-radius:12px;
    font-weight:800;
  }

  .formula{
    background:#f1f1f1;
    border:1px dashed #cfcfcf;
    padding:14px;
    border-radius:14px;
    font-weight:1000;
    font-size:20px;
    line-height:1.55;
    margin-top:10px;
  }

  .result{
    font-size:24px;
    font-weight:1100;
    color:var(--bad);
    margin: 12px 0 4px;
  }

  .small{
    color:var(--muted);
    font-size:18px;
    margin:6px 0 0;
  }

  /* バー（割合の視覚化） */
  .bars{
    display:grid;
    grid-template-columns: 1fr;
    gap:12px;
    margin-top:12px;
  }
  .barRow{
    display:grid;
    grid-template-columns: 110px 1fr 120px;
    gap:12px;
    align-items:center;
  }
  .bar{
    height:22px;
    border-radius:999px;
    background:#eaeaea;
    border:1px solid #ddd;
    position:relative;
    overflow:hidden;
  }
  .fillDown{
    position:absolute; left:0; top:0; bottom:0;
    width:0%;
    background:rgba(211,47,47,.86);
  }
  .fillUp{
    position:absolute; left:0; top:0; bottom:0;
    width:0%;
    background:rgba(46,125,50,.78);
  }
  .barLabel{ font-weight:1100; }
  .barPct{ font-weight:1100; text-align:right; white-space:nowrap; }

  .flash{ animation: flash 1s ease-in-out infinite; }
  @keyframes flash{
    0%,100%{ filter:brightness(1); }
    50%{ filter:brightness(1.35); }
  }

  .content{ display:none; }
  .content.active{ display:block; }
</style>
</head>

<body>
<header>ITパスポート：稼働率（直列・並列）アニメ＋段階説明</header>

<div class="tabs">
  <div class="tab active" data-tab="parallel" onclick="showTab('parallel')">並列システム</div>
  <div class="tab" data-tab="series" onclick="showTab('series')">直列システム</div>
</div>

<div class="wrap">

  <!-- =================== 並列 =================== -->
  <section id="parallel" class="content active">

    <div class="card">
      <h2>並列システム：片方が止まっても全体は動く</h2>
      <p class="lead">ルートが2本ある。どちらか一方でも流れが通れば「全体は稼働」。両方止まると停止。</p>
    </div>

    <div class="grid">

      <!-- 左：アニメ -->
      <div class="card stage">
        <div class="legend">
          <span class="pill"><span class="dot good"></span>流れが通る（稼働）</span>
          <span class="pill"><span class="dot bad"></span>止まって通らない（停止）</span>
          <span class="pill"><span class="dot neu"></span>信号（データ）</span>
        </div>

        <svg class="svgBox" viewBox="0 0 900 260" aria-label="parallel animation">
          <text x="20" y="32" font-size="22" font-weight="1000" fill="#333">入力</text>
          <text x="835" y="32" font-size="22" font-weight="1000" fill="#333">出力</text>

          <!-- 分岐・合流 -->
          <circle cx="120" cy="130" r="18" fill="#444"/>
          <text x="108" y="136" font-size="16" font-weight="1000" fill="#fff">分</text>

          <circle cx="780" cy="130" r="18" fill="#444"/>
          <text x="768" y="136" font-size="16" font-weight="1000" fill="#fff">合</text>

          <!-- 入出力ライン -->
          <line x1="20" y1="130" x2="102" y2="130" stroke="#888" stroke-width="8" stroke-linecap="round"/>
          <line x1="138" y1="130" x2="762" y2="130" stroke="#888" stroke-width="8" stroke-linecap="round"/>

          <!-- 上下ルート -->
          <path d="M138,130 C220,60 340,60 420,60 C500,60 620,60 762,130"
                fill="none" stroke="#bbb" stroke-width="10" stroke-linecap="round"/>
          <path d="M138,130 C220,200 340,200 420,200 C500,200 620,200 762,130"
                fill="none" stroke="#bbb" stroke-width="10" stroke-linecap="round"/>

          <!-- 装置A/B -->
          <rect x="370" y="35" width="160" height="50" rx="12" fill="#e9f5ea" stroke="#b7e0bb" stroke-width="2" id="p_devA"/>
          <text x="395" y="67" font-size="22" font-weight="1000" fill="#1b5e20">装置A</text>

          <rect x="370" y="175" width="160" height="50" rx="12" fill="#e9f5ea" stroke="#b7e0bb" stroke-width="2" id="p_devB"/>
          <text x="395" y="207" font-size="22" font-weight="1000" fill="#1b5e20">装置B</text>

          <!-- 信号 -->
          <circle id="p_signal" cx="30" cy="130" r="10" fill="#666"/>
          <text id="p_caption" x="20" y="250" font-size="22" font-weight="1000" fill="#333"></text>
        </svg>

        <div class="controls">
          <button onclick="playParallel('Aon_Bon')">A稼働 / B稼働</button>
          <button onclick="playParallel('Aon_Boff')">A稼働 / B停止</button>
          <button onclick="playParallel('Aoff_Bon')">A停止 / B稼働</button>
          <button class="secondary" onclick="playParallel('Aoff_Boff')">A停止 / B停止</button>
        </div>

        <p class="small">並列は「どちらかのルートが生きていればOK」。両方停止だけが全体停止。</p>
      </div>

      <!-- 右：式の意味（段階説明） -->
      <div class="card">
        <h2>並列の式：なぜ <span class="pill">1 − (1 − A)×(1 − B)</span>？</h2>

        <div class="hint">全体が止まるのは「AもBも止まっている」場合だけ。</div>

        <div class="formula">
          全体稼働率 ＝ 1 −（全体停止率）<br>
          全体停止率 ＝（停止率A）×（停止率B） ＝ (1−A)×(1−B)
        </div>

        <div class="controls">
          <label>A</label><input type="number" id="pA" value="0.90" step="0.01" min="0" max="1">
          <label>B</label><input type="number" id="pB" value="0.90" step="0.01" min="0" max="1">
          <button onclick="pExplainNext()">説明：次へ</button>
          <button class="secondary" onclick="pExplainReset()">リセット</button>
        </div>

        <div class="bars" id="p_bars" style="display:none">
          <div class="barRow">
            <div class="barLabel">A</div>
            <div class="bar">
              <div class="fillDown" id="pA_down"></div>
              <div class="fillUp" id="pA_up"></div>
            </div>
            <div class="barPct" id="pA_txt"></div>
          </div>

          <div class="barRow">
            <div class="barLabel">B</div>
            <div class="bar">
              <div class="fillDown" id="pB_down"></div>
              <div class="fillUp" id="pB_up"></div>
            </div>
            <div class="barPct" id="pB_txt"></div>
          </div>

          <div class="barRow">
            <div class="barLabel">全停止</div>
            <div class="bar">
              <div class="fillDown flash" id="pAll_down"></div>
              <div class="fillUp" id="pAll_up"></div>
            </div>
            <div class="barPct" id="pAll_txt"></div>
          </div>

          <div class="barRow">
            <div class="barLabel">全稼働</div>
            <div class="bar">
              <div class="fillDown" id="pRun_down"></div>
              <div class="fillUp flash" id="pRun_up"></div>
            </div>
            <div class="barPct" id="pRun_txt"></div>
          </div>
        </div>

        <p class="result" id="parallelResult"></p>
        <p class="small" id="p_steps"></p>
      </div>

    </div>
  </section>

  <!-- =================== 直列 =================== -->
  <section id="series" class="content">

    <div class="card">
      <h2>直列システム：1つでも止まると全体が止まる</h2>
      <p class="lead">通り道が1本。途中で止まると、信号が出力に届かない（＝全体停止）。</p>
    </div>

    <div class="grid">

      <!-- 左：アニメ -->
      <div class="card stage">
        <div class="legend">
          <span class="pill"><span class="dot good"></span>流れが通る（稼働）</span>
          <span class="pill"><span class="dot bad"></span>止まって通らない（停止）</span>
          <span class="pill"><span class="dot.neu dot"></span>信号（データ）</span>
        </div>

        <svg class="svgBox" viewBox="0 0 900 260" aria-label="series animation">
          <text x="20" y="40" font-size="22" font-weight="1000" fill="#333">入力</text>
          <text x="835" y="40" font-size="22" font-weight="1000" fill="#333">出力</text>

          <line x1="20" y1="130" x2="880" y2="130" stroke="#bbb" stroke-width="10" stroke-linecap="round" />

          <rect x="250" y="95" width="160" height="70" rx="14" fill="#e9f5ea" stroke="#b7e0bb" stroke-width="2" id="s_devA"/>
          <text x="305" y="138" font-size="24" font-weight="1000" fill="#1b5e20">装置A</text>

          <rect x="520" y="95" width="160" height="70" rx="14" fill="#e9f5ea" stroke="#b7e0bb" stroke-width="2" id="s_devB"/>
          <text x="575" y="138" font-size="24" font-weight="1000" fill="#1b5e20">装置B</text>

          <circle id="s_signal" cx="30" cy="130" r="10" fill="#666"/>
          <text id="s_caption" x="20" y="250" font-size="22" font-weight="1000" fill="#333"></text>
        </svg>

        <div class="controls">
          <button onclick="playSeries('Aon_Bon')">A稼働 / B稼働</button>
          <button onclick="playSeries('Aoff_Bon')">A停止 / B稼働</button>
          <button onclick="playSeries('Aon_Boff')">A稼働 / B停止</button>
          <button class="secondary" onclick="playSeries('Aoff_Boff')">A停止 / B停止</button>
        </div>

        <p class="small">直列は「両方稼働が必要」。1つでも停止すると信号が途中で止まり、全体停止。</p>
      </div>

      <!-- 右：式の意味（段階説明） -->
      <div class="card">
        <h2>直列の式：なぜ <span class="pill">A×B</span>？</h2>

        <div class="hint">全体が動く条件は「AもBも動いている」こと。</div>

        <div class="formula">全体稼働率 ＝ 稼働率A × 稼働率B</div>

        <div class="controls">
          <label>A</label><input type="number" id="sA" value="0.90" step="0.01" min="0" max="1">
          <label>B</label><input type="number" id="sB" value="0.90" step="0.01" min="0" max="1">
          <button onclick="sExplainNext()">説明：次へ</button>
          <button class="secondary" onclick="sExplainReset()">リセット</button>
        </div>

        <div class="bars" id="s_bars" style="display:none">
          <div class="barRow">
            <div class="barLabel">A</div>
            <div class="bar">
              <div class="fillDown" id="sA_down"></div>
              <div class="fillUp" id="sA_up"></div>
            </div>
            <div class="barPct" id="sA_txt"></div>
          </div>

          <div class="barRow">
            <div class="barLabel">B</div>
            <div class="bar">
              <div class="fillDown" id="sB_down"></div>
              <div class="fillUp" id="sB_up"></div>
            </div>
            <div class="barPct" id="sB_txt"></div>
          </div>

          <div class="barRow">
            <div class="barLabel">全稼働</div>
            <div class="bar">
              <div class="fillDown" id="sRun_down"></div>
              <div class="fillUp flash" id="sRun_up"></div>
            </div>
            <div class="barPct" id="sRun_txt"></div>
          </div>
        </div>

        <p class="result" id="seriesResult"></p>
        <p class="small" id="s_steps"></p>
      </div>

    </div>
  </section>

</div>

<script>
/* ===================== タブ ===================== */
function showTab(id){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.content').forEach(c=>c.classList.remove('active'));
  document.querySelector(`.tab[data-tab="${id}"]`).classList.add('active');
  document.getElementById(id).classList.add('active');
}

/* ===================== 便利関数 ===================== */
function clamp01(x){
  if (Number.isNaN(x)) return 0;
  return Math.min(1, Math.max(0, x));
}
function pct(x){ return (x*100).toFixed(1) + "%"; }
function setDeviceState(rectEl, isOn){
  if(isOn){
    rectEl.setAttribute("fill", "#e9f5ea");
    rectEl.setAttribute("stroke", "#b7e0bb");
  }else{
    rectEl.setAttribute("fill", "#fdeaea");
    rectEl.setAttribute("stroke", "#f3b2b2");
  }
}

/* ===================== 並列アニメ ===================== */
let p_anim = null;
function playParallel(mode){
  if (p_anim) cancelAnimationFrame(p_anim);

  const devA = document.getElementById("p_devA");
  const devB = document.getElementById("p_devB");
  const cap  = document.getElementById("p_caption");
  const signal = document.getElementById("p_signal");

  let Aon = true, Bon = true;
  if(mode==="Aon_Boff"){Aon=true; Bon=false;}
  if(mode==="Aoff_Bon"){Aon=false; Bon=true;}
  if(mode==="Aoff_Boff"){Aon=false; Bon=false;}

  setDeviceState(devA, Aon);
  setDeviceState(devB, Bon);

  let route = null;
  if(Aon) route = "upper";
  else if(Bon) route = "lower";
  else route = null;

  cap.textContent = route
    ? `✅ ${route==="upper" ? "Aルート" : "Bルート"}で出力へ → 全体は稼働`
    : `❌ AもBも停止 → 通れない → 全体停止`;

  const start = {x:30, y:130};
  const mid1  = route==="upper" ? {x:450,y:60} : {x:450,y:200};
  const end   = {x:860,y:130};
  const stopPoint = {x:120,y:130};

  let t0=null;
  function step(ts){
    if(!t0) t0=ts;
    const dt = (ts - t0)/1000;
    const duration = 2.1;

    if(!route){
      const p = Math.min(1, dt/1.0);
      const x = start.x + (stopPoint.x - start.x)*p;
      const y = start.y + (stopPoint.y - start.y)*p;
      const shake = (dt>1.0) ? Math.sin(dt*24)*2 : 0;
      signal.setAttribute("cx", x);
      signal.setAttribute("cy", y + shake);
      if(dt < 2.0) p_anim = requestAnimationFrame(step);
      return;
    }

    const u = Math.min(1, dt/duration);
    let x,y;
    if(u<0.48){
      const p = u/0.48;
      x = start.x + (mid1.x - start.x)*p;
      y = start.y + (mid1.y - start.y)*p;
    }else{
      const p = (u-0.48)/0.52;
      x = mid1.x + (end.x - mid1.x)*p;
      y = mid1.y + (end.y - mid1.y)*p;
    }

    const r = 10 + Math.sin(dt*10)*1.2;
    signal.setAttribute("r", r.toFixed(2));
    signal.setAttribute("cx", x);
    signal.setAttribute("cy", y);

    if(u<1) p_anim = requestAnimationFrame(step);
  }
  p_anim = requestAnimationFrame(step);
}

/* ===================== 直列アニメ ===================== */
let s_anim = null;
function playSeries(mode){
  if (s_anim) cancelAnimationFrame(s_anim);

  const devA = document.getElementById("s_devA");
  const devB = document.getElementById("s_devB");
  const cap  = document.getElementById("s_caption");
  const signal = document.getElementById("s_signal");

  let Aon = true, Bon = true;
  if(mode==="Aoff_Bon"){Aon=false; Bon=true;}
  if(mode==="Aon_Boff"){Aon=true; Bon=false;}
  if(mode==="Aoff_Boff"){Aon=false; Bon=false;}

  setDeviceState(devA, Aon);
  setDeviceState(devB, Bon);

  let stopX = 860;
  let message = "✅ AもBも稼働 → 信号が最後まで届く → 全体は稼働";
  if(!Aon){
    stopX = 260; // A付近
    message = "❌ Aが停止 → 信号がAで止まる → 全体停止";
  }else if(!Bon){
    stopX = 530; // B付近
    message = "❌ Bが停止 → 信号がBで止まる → 全体停止";
  }
  cap.textContent = message;

  const startX = 30;
  const y = 130;

  let t0=null;
  function step(ts){
    if(!t0) t0=ts;
    const dt=(ts-t0)/1000;
    const duration = 2.0;

    const u = Math.min(1, dt/duration);
    const x = startX + (stopX - startX)*u;

    let shake = 0;
    if(u>=1 && stopX<860) shake = Math.sin(dt*24)*2.5;

    const r = 10 + Math.sin(dt*9)*1.1;
    signal.setAttribute("r", r.toFixed(2));
    signal.setAttribute("cx", x);
    signal.setAttribute("cy", y + shake);

    if(u<1 || (stopX<860 && dt<3.0)){
      s_anim = requestAnimationFrame(step);
    }
  }
  s_anim = requestAnimationFrame(step);
}

/* ===================== 段階説明（並列） ===================== */
let pStep = 0;
function pExplainReset(){
  pStep = 0;
  document.getElementById("p_bars").style.display = "none";
  document.getElementById("parallelResult").textContent = "";
  document.getElementById("p_steps").textContent = "「説明：次へ」を押すたびに、1ステップずつ進みます。";

  ["pA_down","pA_up","pB_down","pB_up","pAll_down","pAll_up","pRun_down","pRun_up"].forEach(id=>{
    const el = document.getElementById(id);
    if(el) el.style.width = "0%";
  });
  ["pA_txt","pB_txt","pAll_txt","pRun_txt"].forEach(id=>{
    const el = document.getElementById(id);
    if(el) el.textContent = "";
  });
}

function pExplainNext(){
  const A = clamp01(parseFloat(document.getElementById("pA").value));
  const B = clamp01(parseFloat(document.getElementById("pB").value));
  const downA = 1 - A;
  const downB = 1 - B;
  const allDown = downA * downB;
  const allUp = 1 - allDown;

  document.getElementById("p_bars").style.display = "grid";

  const setBar = (idDown, idUp, down, up) => {
    document.getElementById(idDown).style.width = (down*100) + "%";
    document.getElementById(idUp).style.width = (up*100) + "%";
  };

  const stepsEl = document.getElementById("p_steps");
  const resEl = document.getElementById("parallelResult");

  // 1→2→3→4→0（案内）→1…（循環）
  pStep = (pStep + 1) % 5;

  if(pStep === 1){
    setBar("pA_down","pA_up", downA, A);
    document.getElementById("pA_txt").textContent = `停止 ${pct(downA)} / 稼働 ${pct(A)}`;
    stepsEl.innerHTML = `① まず「停止率A」を作る。<b>停止率A = 1−A</b> → ${pct(downA)}`;
    resEl.textContent = "";
  }else if(pStep === 2){
    setBar("pB_down","pB_up", downB, B);
    document.getElementById("pB_txt").textContent = `停止 ${pct(downB)} / 稼働 ${pct(B)}`;
    stepsEl.innerHTML = `② 次に「停止率B」。<b>停止率B = 1−B</b> → ${pct(downB)}`;
  }else if(pStep === 3){
    setBar("pAll_down","pAll_up", allDown, 1-allDown);
    document.getElementById("pAll_txt").textContent = `全停止 ${pct(allDown)}`;
    stepsEl.innerHTML =
      `③ 並列の「全停止」は <b>AもBも停止</b>のときだけ。<br>` +
      `　だから <b>全停止率 = 停止率A × 停止率B</b> → ${pct(downA)} × ${pct(downB)} = <b>${pct(allDown)}</b>`;
  }else if(pStep === 4){
    setBar("pRun_down","pRun_up", 1-allUp, allUp);
    document.getElementById("pRun_txt").textContent = `全稼働 ${pct(allUp)}`;
    stepsEl.innerHTML =
      `④ 稼働率は「止まっている分を引く」。<br>` +
      `　<b>全体稼働率 = 1 − 全停止率</b> → 1 − ${pct(allDown)} = <b>${pct(allUp)}</b>`;
    resEl.textContent = `システム稼働率 = ${allUp.toFixed(3)}`;
  }else{
    stepsEl.textContent = "（繰り返し）もう一度押すと①から説明を再開します。";
  }
}

/* ===================== 段階説明（直列） ===================== */
let sStep = 0;
function sExplainReset(){
  sStep = 0;
  document.getElementById("s_bars").style.display = "none";
  document.getElementById("seriesResult").textContent = "";
  document.getElementById("s_steps").textContent = "「説明：次へ」を押すたびに、1ステップずつ進みます。";

  ["sA_down","sA_up","sB_down","sB_up","sRun_down","sRun_up"].forEach(id=>{
    const el = document.getElementById(id);
    if(el) el.style.width = "0%";
  });
  ["sA_txt","sB_txt","sRun_txt"].forEach(id=>{
    const el = document.getElementById(id);
    if(el) el.textContent = "";
  });
}

function sExplainNext(){
  const A = clamp01(parseFloat(document.getElementById("sA").value));
  const B = clamp01(parseFloat(document.getElementById("sB").value));
  const run = A * B;

  document.getElementById("s_bars").style.display = "grid";

  const setBar = (idDown, idUp, down, up) => {
    document.getElementById(idDown).style.width = (down*100) + "%";
    document.getElementById(idUp).style.width = (up*100) + "%";
  };

  const stepsEl = document.getElementById("s_steps");
  const resEl = document.getElementById("seriesResult");

  // 1→2→3→0（案内）→1…（循環）
  sStep = (sStep + 1) % 4;

  if(sStep === 1){
    setBar("sA_down","sA_up", 1-A, A);
    document.getElementById("sA_txt").textContent = `稼働 ${pct(A)}`;
    stepsEl.innerHTML = `① 直列は「通り道が1本」。まず <b>Aが稼働</b>が必要 → ${pct(A)}`;
    resEl.textContent = "";
  }else if(sStep === 2){
    setBar("sB_down","sB_up", 1-B, B);
    document.getElementById("sB_txt").textContent = `稼働 ${pct(B)}`;
    stepsEl.innerHTML = `② 次に <b>Bも稼働</b>が必要 → ${pct(B)}`;
  }else if(sStep === 3){
    setBar("sRun_down","sRun_up", 1-run, run);
    document.getElementById("sRun_txt").textContent = `全稼働 ${pct(run)}`;
    stepsEl.innerHTML =
      `③ 全体が動くのは「AもBも稼働」だけ。だから <b>全体稼働率 = A×B</b>。<br>` +
      `　${pct(A)} × ${pct(B)} = <b>${pct(run)}</b>`;
    resEl.textContent = `システム稼働率 = ${run.toFixed(3)}`;
  }else{
    stepsEl.textContent = "（繰り返し）もう一度押すと①から説明を再開します。";
  }
}

/* ===================== 初期化 ===================== */
window.addEventListener("load", ()=>{
  playParallel("Aon_Bon");
  pExplainReset();
  sExplainReset();
});
</script>

</body>
</html>

